<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>JardÃ­n App</title>
    
    <!-- === 1. CAPACIDADES DE WEB APP (PWA) === -->
    <!-- Dice al navegador que puede funcionar como app independiente -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Color de la barra de estado del celular (coincide con el header) -->
    <meta name="theme-color" content="#064e3b">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- TÃ­tulo del icono en el escritorio -->
    <meta name="apple-mobile-web-app-title" content="Mi JardÃ­n">

    <!-- === 2. ICONO GENERADO AUTOMÃTICAMENTE (SVG en Base64) === -->
    <!-- Esto crea el icono de la plantita sin necesitar archivos externos -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 fill=%22%23064e3b%22 rx=%2220%22/><text y=%2250%22 font-size=%2250%22 text-anchor=%22middle%22 x=%2250%22 dy=%22.35em%22>ðŸŒ¿</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 fill=%22%23064e3b%22/><text y=%2250%22 font-size=%2250%22 text-anchor=%22middle%22 x=%2250%22 dy=%22.35em%22>ðŸŒ¿</text></svg>">

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            font-family: system-ui, -apple-system, sans-serif;
            overscroll-behavior-y: none; /* Evita el rebote elÃ¡stico en iOS */
        }
        
        .completed-text {
            text-decoration: line-through;
            color: #9ca3af;
        }

        /* Soporte para el "Notch" del iPhone */
        header {
            padding-top: env(safe-area-inset-top);
        }
        .bottom-safe-area {
            padding-bottom: env(safe-area-inset-bottom);
        }
    </style>
</head>
<body class="bg-stone-100 min-h-screen pb-32 text-stone-800 select-none">

    <!-- Header Fijo -->
    <header class="bg-emerald-900 text-white px-4 pb-4 pt-4 shadow-lg sticky top-0 z-30">
        <div class="flex justify-between items-end mb-2 pt-2">
            <div>
                <h1 class="text-xl font-bold tracking-wide">JardÃ­n & Mantenimiento</h1>
                <p id="currentDate" class="text-emerald-200 text-sm font-medium mt-1">Cargando...</p>
            </div>
            <div class="text-right">
                <span id="progressText" class="text-2xl font-bold">0%</span>
            </div>
        </div>
        
        <!-- Barra de Progreso -->
        <div class="w-full bg-emerald-800 rounded-full h-3 overflow-hidden">
            <div id="progressBar" class="bg-lime-400 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
        </div>
    </header>

    <!-- Contenedor de Tareas -->
    <main class="p-4 max-w-lg mx-auto" id="taskListContainer">
        <!-- JS inyecta aquÃ­ -->
    </main>
    
    <div class="h-12"></div>

    <!-- Botonera Flotante Inferior -->
    <div class="fixed bottom-0 left-0 w-full bg-white/95 backdrop-blur border-t border-stone-200 p-3 shadow-[0_-4px_10px_rgba(0,0,0,0.1)] z-40 flex gap-3 justify-center items-center bottom-safe-area">
        
        <button onclick="resetDay()" class="flex-1 bg-stone-100 active:bg-stone-200 text-stone-700 font-bold py-3 px-4 rounded-xl shadow-sm border border-stone-300 flex items-center justify-center gap-2 transition-transform active:scale-95 text-sm">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74-2.74L3 12"/></svg>
            Reiniciar Hoy
        </button>

        <button onclick="openModal()" class="bg-emerald-600 active:bg-emerald-700 text-white p-3 rounded-xl shadow-md flex items-center justify-center transition-transform active:scale-95 aspect-square">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
        </button>
    </div>

    <!-- Modal Agregar -->
    <div id="addTaskModal" class="hidden fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-2xl shadow-2xl overflow-hidden animate-bounce-in">
            <div class="bg-emerald-800 p-4 text-white flex justify-between items-center">
                <h2 class="font-bold text-lg">Nueva Tarea</h2>
                <button onclick="closeModal()" class="text-emerald-200 hover:text-white text-xl px-2">âœ•</button>
            </div>
            <div class="p-5 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-stone-600 mb-1">DescripciÃ³n</label>
                    <input type="text" id="newTaskInput" placeholder="Ej: Podar..." class="w-full p-3 border border-stone-300 rounded-lg focus:ring-2 focus:ring-emerald-500 outline-none text-lg">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-stone-600 mb-2">Prioridad</label>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="selectPriority('critical')" id="btn-critical" class="priority-btn p-2 rounded border border-red-200 bg-red-50 text-red-700 text-sm font-bold">Urgente</button>
                        <button onclick="selectPriority('high')" id="btn-high" class="priority-btn p-2 rounded border border-orange-200 bg-orange-50 text-orange-700 text-sm font-bold">Alta</button>
                        <button onclick="selectPriority('medium')" id="btn-medium" class="priority-btn p-2 rounded border border-blue-200 bg-blue-50 text-blue-700 text-sm font-bold">Media</button>
                        <button onclick="selectPriority('low')" id="btn-low" class="priority-btn p-2 rounded border border-emerald-200 bg-emerald-50 text-emerald-700 text-sm font-bold ring-2 ring-emerald-500">Baja</button>
                    </div>
                </div>

                <div class="pt-2">
                    <button onclick="addNewTask()" class="w-full bg-emerald-600 text-white font-bold py-3 rounded-lg shadow active:bg-emerald-700 transform active:scale-95 transition-all">
                        Guardar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURACIÃ“N Y DATOS
        const DEFAULT_TASKS = [
            { id: 1703300000001, text: "Riego antes de Navidad", priority: "critical", checkedDay: false, checkedTotal: false },
            { id: 1703300000002, text: "Ordenar frontal y esconder maquinaria", priority: "high", checkedDay: false, checkedTotal: false },
            { id: 1703300000003, text: "Reafirmar atadura ejemplares", priority: "medium", checkedDay: false, checkedTotal: false },
            { id: 1703300000004, text: "Reponer plantas desde fondo", priority: "medium", checkedDay: false, checkedTotal: false },
            { id: 1703300000005, text: "Ir desarmando micro tÃºnel", priority: "low", checkedDay: false, checkedTotal: false },
            { id: 1703300000006, text: "Mesa y bancos madera", priority: "low", checkedDay: false, checkedTotal: false }
        ];

        const PRIORITY_STYLES = {
            critical: { color: "border-red-500", bg: "bg-red-50", text: "text-red-700", label: "URGENTE" },
            high: { color: "border-orange-500", bg: "bg-orange-50", text: "text-orange-700", label: "ALTA" },
            medium: { color: "border-blue-500", bg: "bg-blue-50", text: "text-blue-700", label: "MEDIA" },
            low: { color: "border-emerald-500", bg: "bg-emerald-50", text: "text-emerald-700", label: "BAJA" }
        };

        let appState = [];
        let selectedPriority = 'low';

        // INICIALIZACIÃ“N
        function initApp() {
            setTodayDate();
            loadState();
            renderTasks();
            updateProgress();
        }

        function setTodayDate() {
            try {
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                const today = new Date().toLocaleDateString('es-ES', options);
                document.getElementById('currentDate').textContent = today.charAt(0).toUpperCase() + today.slice(1);
            } catch (e) {
                document.getElementById('currentDate').textContent = "JardÃ­n Digital";
            }
        }

        function loadState() {
            const saved = localStorage.getItem('gardenApp_v4'); // CambiÃ© la key a v4 para evitar conflictos
            if (saved) {
                appState = JSON.parse(saved);
            } else {
                appState = JSON.parse(JSON.stringify(DEFAULT_TASKS));
                saveState();
            }
        }

        function saveState() {
            localStorage.setItem('gardenApp_v4', JSON.stringify(appState));
            updateProgress();
        }

        // LÃ“GICA PRINCIPAL
        function toggleDay(id) {
            const task = appState.find(t => t.id === id);
            if (task) {
                task.checkedDay = !task.checkedDay;
                saveState();
                renderSingleTaskUpdate(task); 
            }
        }

        function toggleTotal(id) {
            const task = appState.find(t => t.id === id);
            if (task) {
                task.checkedTotal = !task.checkedTotal;
                if (task.checkedTotal) task.checkedDay = true;
                saveState();
                renderTasks();
            }
        }

        function resetDay() {
            if(confirm("Â¿Nueva jornada? Se borrarÃ¡n los avances verdes de hoy.")){
                appState.forEach(task => task.checkedDay = false);
                saveState();
                renderTasks();
            }
        }

        function deleteTask(id) {
            if(confirm("Â¿Eliminar esta tarea definitivamente?")){
                appState = appState.filter(t => t.id !== id);
                saveState();
                renderTasks();
            }
        }

        function openModal() {
            document.getElementById('addTaskModal').classList.remove('hidden');
            setTimeout(() => document.getElementById('newTaskInput').focus(), 100);
            selectPriority('low');
        }

        function closeModal() {
            document.getElementById('addTaskModal').classList.add('hidden');
            document.getElementById('newTaskInput').value = '';
        }

        function selectPriority(prio) {
            selectedPriority = prio;
            document.querySelectorAll('.priority-btn').forEach(btn => {
                btn.classList.remove('ring-2', 'ring-emerald-500', 'ring-offset-1');
                btn.style.opacity = '0.6';
            });
            const activeBtn = document.getElementById(`btn-${prio}`);
            activeBtn.classList.add('ring-2', 'ring-emerald-500', 'ring-offset-1');
            activeBtn.style.opacity = '1';
        }

        function addNewTask() {
            const input = document.getElementById('newTaskInput');
            const text = input.value.trim();
            if (!text) return alert("Escribe un nombre para la tarea");

            const newTask = {
                id: Date.now(),
                text: text,
                priority: selectedPriority,
                checkedDay: false,
                checkedTotal: false
            };

            appState.unshift(newTask);
            saveState();
            renderTasks();
            closeModal();
        }

        function updateProgress() {
            if (appState.length === 0) {
                document.getElementById('progressBar').style.width = `0%`;
                document.getElementById('progressText').textContent = `0%`;
                return;
            }
            const completed = appState.filter(t => t.checkedTotal).length;
            const percentage = Math.round((completed / appState.length) * 100);
            document.getElementById('progressBar').style.width = `${percentage}%`;
            document.getElementById('progressText').textContent = `${percentage}%`;
        }

        // RENDERIZADO
        function renderTasks() {
            const container = document.getElementById('taskListContainer');
            container.innerHTML = '';

            if (appState.length === 0) {
                container.innerHTML = `
                    <div class="text-center p-8 text-stone-400">
                        <p class="text-4xl mb-4">ðŸŒ¿</p>
                        <p>No hay tareas pendientes.</p>
                        <p class="text-sm">Usa el botÃ³n + para agregar.</p>
                    </div>`;
                return;
            }

            appState.forEach(task => {
                const styles = PRIORITY_STYLES[task.priority] || PRIORITY_STYLES['low'];
                const isTotalDone = task.checkedTotal;
                const isDayDone = task.checkedDay;

                const card = document.createElement('div');
                card.id = `task-${task.id}`;
                card.className = `bg-white rounded-xl shadow-sm mb-4 overflow-hidden border-l-8 ${styles.color} flex flex-col relative group`;
                
                card.innerHTML = `
                    <div class="p-4 flex-grow pr-10">
                        <div class="flex justify-between items-start mb-1">
                            <span class="text-[10px] font-bold px-2 py-0.5 rounded bg-stone-100 ${styles.text} uppercase tracking-wider">
                                ${styles.label}
                            </span>
                        </div>
                        <h3 class="text-lg font-medium leading-tight ${isTotalDone ? 'completed-text' : 'text-stone-800'}">
                            ${task.text}
                        </h3>
                    </div>

                    <button onclick="deleteTask(${task.id})" class="absolute top-2 right-2 p-2 text-stone-300 hover:text-red-500 active:text-red-500 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
                    </button>

                    <div class="grid grid-cols-2 border-t border-stone-100 divide-x divide-stone-100 h-14">
                        <button onclick="toggleDay(${task.id})" 
                            id="btn-day-${task.id}"
                            class="flex flex-col items-center justify-center active:bg-stone-100 transition-colors ${isDayDone ? 'bg-emerald-50' : 'bg-white'}">
                            <div class="w-5 h-5 rounded-full border-2 flex items-center justify-center mb-0.5
                                ${isDayDone ? 'border-emerald-500 bg-emerald-500' : 'border-stone-300'}">
                                ${isDayDone ? '<svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>' : ''}
                            </div>
                            <span class="text-[10px] font-bold ${isDayDone ? 'text-emerald-700' : 'text-stone-400'}">HOY</span>
                        </button>

                        <button onclick="toggleTotal(${task.id})" 
                            class="flex flex-col items-center justify-center active:bg-stone-100 transition-colors ${isTotalDone ? 'bg-stone-800' : 'bg-white'}">
                            <div class="w-5 h-5 rounded border-2 flex items-center justify-center mb-0.5
                                ${isTotalDone ? 'border-stone-600 bg-stone-600' : 'border-stone-300'}">
                                ${isTotalDone ? '<svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>' : ''}
                            </div>
                            <span class="text-[10px] font-bold ${isTotalDone ? 'text-white' : 'text-stone-400'}">LISTO</span>
                        </button>
                    </div>
                `;
                container.appendChild(card);
            });
        }
        function renderSingleTaskUpdate(task) {
           const btnDay = document.getElementById(`btn-day-${task.id}`);
           if(btnDay) {
               const isDayDone = task.checkedDay;
               btnDay.className = `flex flex-col items-center justify-center active:bg-stone-100 transition-colors ${isDayDone ? 'bg-emerald-50' : 'bg-white'}`;
               btnDay.innerHTML = `
                    <div class="w-5 h-5 rounded-full border-2 flex items-center justify-center mb-0.5
                        ${isDayDone ? 'border-emerald-500 bg-emerald-500' : 'border-stone-300'}">
                        ${isDayDone ? '<svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>' : ''}
                    </div>
                    <span class="text-[10px] font-bold ${isDayDone ? 'text-emerald-700' : 'text-stone-400'}">HOY</span>
               `;
           }
        }
        initApp();
    </script>
</body>
</html>
